<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed layout-compact"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../../assets/"
  data-template="vertical-menu-template-no-customizer">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Dashboard - Analytics | Vuexy - Bootstrap Admin Template</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../static/assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
      rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href=../../static/assets/vendor/fonts/fontawesome.css" />
    <link rel="stylesheet" href="../../static/assets/vendor/fonts/tabler-icons.css" />

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <!-- Core CSS -->
    <link rel="stylesheet" href="../../static/assets/vendor/css/rtl/core.css" />
    <link rel="stylesheet" href="../../static/assets/vendor/css/rtl/theme-default.css" />
    <link rel="stylesheet" href="../../static/assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../../static/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css" />
    <link rel="stylesheet" href="../../static/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" />
    <link rel="stylesheet" href="../../static/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css" />
    <!-- Page CSS -->
    <link rel="stylesheet" href="../../static/assets/vendor/css/pages/cards-advance.css" />

    <!-- Helpers -->
    <script src="../../static/assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../../static/assets/js/config.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="index.html" class="app-brand-link">

              <span class="app-brand-text demo menu-text fw-bold">Projet IoT</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="ti menu-toggle-icon d-none d-xl-block ti-sm align-middle"></i>
              <i class="ti ti-x d-block d-xl-none ti-sm align-middle"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-5">
            <!-- Dashboards -->
            <li class="menu-item active open">
              <a href="{% url 'index' %}" class="menu-link">
                <i class="menu-icon tf-icons ti ti-smart-home"></i>
                <div data-i18n="Dashboard">Dashboard</div>
              </a>

            </li>



            <!-- Tables -->
            <li class="menu-item">
              <a href="{% url 'table' %}" class="menu-link">
                <i class="menu-icon tf-icons ti ti-table"></i>
                <div data-i18n="Tables">Tables</div>
              </a>
            </li>



            <li class="menu-item">
              <a href="{% url 'chart' %}" class="menu-link">
                <i class="menu-icon tf-icons ti ti-chart-pie"></i>
                <div data-i18n="Charts">Charts</div>
              </a>

            </li>
            <li class="menu-item">
              <a href="{% url 'json' %}" class="menu-link">
                <i class="menu-icon tf-icons ti ti-lifebuoy"></i>
                <div >API</div>
              </a>

            </li>
               <li class="menu-item">
              <a href="{% url 'download_csv' %}" class="menu-link">
                <i class="menu-icon tf-icons ti ti-file-description"></i>
                <div >DownLoad CSV</div>
              </a>

            </li>


            <!-- Misc -->

            <li class="menu-item mb-5">
              <a href="{% url 'logout' %}" target="_blank" class="menu-link">
                <i class="menu-icon tf-icons ti ti-logout"></i>
                <div data-i18n="Se Deconnecter">Se deconnecter</div>
              </a>
            </li>

          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">

              <div class="row">


                <!-- Earning Reports -->
                <div class="col-lg-6 mb-4">
                  <div class="card h-100">
                    <div class="card-header pb-0 d-flex justify-content-between mb-lg-n4">
                      <div class="card-title mb-0">
                        <h5 class="mb-0">Temperature</h5>
                      </div>
                      <div class="dropdown">
                        <button
                          class="btn p-0"
                          type="button"
                          id="earningReportsId"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false">
                          <i class="ti ti-dots-vertical ti-sm text-muted"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="earningReportsId">
                          <a onclick="loadChart('jour')" class="dropdown-item" href="javascript:void(0);">
                              <span class="day"> Par Jour</span> </a>
                          <a onclick="loadChart('semaine')" class="dropdown-item" href="javascript:void(0);">
                              <span class="week"> Par Semaine</span> </a>
                          <a onclick="loadChart('mois')" class="dropdown-item" href="javascript:void(0);">
                              <span class="month"> Par Mois</span> </a>
                        </div>
                      </div>
                      <!-- </div> -->
                    </div>
                    <div class="card-body my-3">
                      <div class="row">
                           <div id="tempCart"></div>

                      </div>
                    </div>

                  </div>
                </div>
                <!--/ Earning Reports -->

                <!-- Support Tracker -->
                <div class="col-md-6 mb-4">
                  <div class="card h-100">
                    <div class="card-header d-flex justify-content-between pb-0">
                      <div class="card-title mb-0">
                        <h5 class="mb-0">Humdité</h5>
                      </div>
                      <div class="dropdown">
                        <button
                          class="btn p-0"
                          type="button"
                          id="supportTrackerMenu"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false">
                          <i class="ti ti-dots-vertical ti-sm text-muted"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="supportTrackerMenu">
                          <a class="dropdown-item" href="javascript:void(0);">Par Jour</a>
                          <a class="dropdown-item" href="javascript:void(0);">Par Semaine</a>
                          <a class="dropdown-item" href="javascript:void(0);">Par Mois</a>
                        </div>
                      </div>
                    </div>
                    <div class="card-body my-3">
                      <div class="row">
                           <div id="humChart"></div>

                      </div>
                    </div>
                  </div>
                </div>
                <!--/ Support Tracker -->



                <!-- Projects table -->
                <div class="col-md-12 mb-4">
                  <div class="card">
                    <div class="card-datatable table-responsive">
                         <table class="table text-start align-middle table-bordered table-hover mb-0" id="dataTable" width="100%" cellspacing="0">
                            <thead >
                                <tr class="text-dark">
                                    <th>N</th>
                                    <th>Température</th>
                                    <th>Humidité</th>
                                    <th>Date:Heure</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>N</th>
                                    <th>Température</th>
                                    <th>Humidité</th>
                                    <th>Date:Heure</th>
                                </tr>
                            </tfoot>
                            <tbody>
                                {% for i in tab %}
                                    <tr>
                                        <td>{{i.id}}</td>
                                        <td>{{i.temp}}</td>
                                        <td>{{i.hum}}</td>
                                        <td>{{i.dt}}</td>
                                    </tr>
                                {%endfor%}
                            </tbody>
                        </table>

                    </div>
                  </div>
                </div>
                <!--/ Projects table -->
              </div>
            </div>
            <!-- / Content -->

            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              <div class="container-xxl">
                <div
                  class="footer-container d-flex align-items-center justify-content-between py-2 flex-md-row flex-column">
                  <div>
                    ©
                    <script>
                      document.write(new Date().getFullYear());
                    </script>
                    , made with ❤️ by <a href="https://pixinvent.com" target="_blank" class="fw-medium">Pixinvent</a>
                  </div>

                </div>
              </div>
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="../../static/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../../static/assets/vendor/js/bootstrap.js"></script>
    <script src="../../static/assets/vendor/libs/i18n/i18n.js"></script>
    <script src="../../static/assets/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../../static/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>

    <!-- Main JS -->
    <script src="../../static/assets/js/main.js"></script>

    <!-- Page JS -->
    <script src="../../static/assets/js/dashboards-analytics.js"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/v/bs4-4.6.0/dt-1.13.8/datatables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#dataTable').DataTable();
            loadChart('jour');
        });

        function loadChart(period) {
            $.ajax({
                url: '/chart-data-' + period + '/',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Update the chart based on the received data
                    updateChart(data);
                },
                error: function (error) {
                    console.log('Ajax request failed:', error);
                }
            });
        }

        // Variable to store the Morris.js chart instances
        var tempChart;
        var humChart;

        function updateChart(data) {
            // Update the Temperature Chart (tempCart)
            if (tempChart) {
                tempChart.setData(data.temperature.map(function (temp, index) {
                    return { x: data.temps[index], y: temp };
                }));
            } else {
                tempChart = Morris.Line({
                    element: 'tempCart',
                    data: data.temperature.map(function (temp, index) {
                        return { x: data.temps[index], y: temp };
                    }),
                    xkey: 'x',
                    ykeys: ['y'],
                    labels: ['Temperature'],
                    lineColors: ['rgb(243,106,174)'],
                    pointSize: 3,
                    hideHover: 'auto',
                    resize: true
                });
            }

            // Update the Humidity Chart (humChart)
            if (humChart) {
                humChart.setData(data.humidity.map(function (hum, index) {
                    return { x: data.temps[index], y: hum };
                }));
            } else {
                humChart = Morris.Line({
                    element: 'humChart',
                    data: data.humidity.map(function (hum, index) {
                        return { x: data.temps[index], y: hum };
                    }),
                    xkey: 'x',
                    ykeys: ['y'],
                    labels: ['Humidity'],
                    lineColors: ['rgb(231,143,58)'],
                    pointSize: 3,
                    hideHover: 'auto',
                    resize: true
                });
            }
        }


    </script>
  </body>
</html>